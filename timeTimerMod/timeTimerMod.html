<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="timeTimerMod.css">
</head>
<body>
    <div class="graduationSection">
        <div class="circle1"></div>
        <div class="circle2"></div>
        <div class="circle3"></div>
    </div>
    <div class="numberOnClock">
        <div class="number0">0</div>
        <div class="number5">5</div>
        <div class="number10">10</div>
        <div class="number15">15</div>
        <div class="number20">20</div>
        <div class="number25">25</div>
        <div class="number30">30</div>
        <div class="number35">35</div>
        <div class="number40">40</div>
        <div class="number45">45</div>
        <div class="number50">50</div>
        <div class="number55">55</div>
    </div>
    <canvas class="canvas"></canvas>
    <div class="timerSection">
        <input class="setMinutes" type="number" min="1" max="60"><span class="timeLeft">남은시간표시</span>
        <div class="beforeStartBtnSection">
            <button class="timerStartBtn">타이머 시작</button>
            <button class="darkModeBtn">다크모드</button>
            <button class="showNumBtn">숫자표시</button>
        </div>
        <div class="afterStartBtnSection">
            <button>타이머 일시정지</button>
            <button>타이머 다시시작</button>
            <button>타이머 초기화(정지)</button>
        </div>
    </div>

    <script>
      const $canvas = document.querySelector(".canvas");
      const $setMinutes = document.querySelector(".setMinutes");
      const $timerStartBtn = document.querySelector(".timerStartBtn")
      const $darkModeBtn = document.querySelector(".darkModeBtn");
      const $showNumBtn = document.querySelector(".showNumBtn");
      const $timeLeft = document.querySelector(".timeLeft");

      const ctx = $canvas.getContext("2d");

      const lineWidth = 15;
      const lineColor = 'red';

      let lines = []

      function resizeCanvas() {
        $canvas.width = window.innerWidth;
        $canvas.height = window.innerHeight;
      }

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();


      let elapsedSec = 0;
      let nowMin;
      let nowSec;
      function drawSetTime() {
        ctx.clearRect(0, 0, $canvas.width, $canvas.height);
        // 1. 시계 원 그리기
        const centerX = $canvas.width / 2;
        const centerY = $canvas.height / 2;
        const radius = 1100;
        
        // 2. 입력된 분의 비율 계산
        const setMinutes = $setMinutes.value;
        const startAngle = (Math.PI * 3) / 2;
        const endAngle = (Math.PI * 2 / 60) * setMinutes + startAngle
        
        // 3. 시계 원 일부분 채우기
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, endAngle-elapsedSec, false);
        ctx.lineTo(centerX, centerY);
        ctx.fillStyle = 'rgba(255, 0, 0, 0.7)';
        ctx.fill();

        const nowEndAngle = endAngle-elapsedSec
        const diff = nowEndAngle- startAngle;
        const nowAngle = diff * (180/Math.PI);
        const nowTotalSec = nowAngle.toFixed(2)/0.1 + 1;
        nowMin = Math.floor(nowTotalSec/60);
        nowSec = Math.floor(nowTotalSec%60)
        console.log(nowTotalSec);

        //Angle value to decrease per minute
        elapsedSec += 6 * (Math.PI/180) * (1/3600);

        $timeLeft.textContent = `${nowMin}분 ${nowSec}초`

        //For smooth movement
        let intervalDrawing =  setTimeout(drawSetTime, 1000/60)
      }

      //정지 -> 리셋하고 같나?
      function stopTimer() {
        clearTimeout(intervalDrawing);
        resetTimer();
      }
      // 타이머 리셋
      function resetTimer() {
        
      }

      //다크모드
      function darkMode() {
        $canvas.classList.toggle('darkMode');
        $darkModeBtn.textContent = ($darkModeBtn.textContent == '다크모드')? $darkModeBtn.textContent = '라이트모드' : $darkModeBtn.textContent = '다크모드'
    }

      //시계 숫자,눈금 표시
      function displayNumber() {
        const circle_1 = document.querySelector('.circle1');

        // 눈금 그리기
        for (let i = 0; i < 30; i++) {
        const line = document.createElement('div');
        line.classList.add('line');
        line.style.transform = `rotate(${6 * i}deg)`;
        if (i % 5) {
            line.classList.add('thin');
        } else {
            line.classList.add('thick');
        }
        circle_1.appendChild(line);
        }
      }
      displayNumber();

      $timerStartBtn.addEventListener('click', drawSetTime);
      $darkModeBtn.addEventListener('click', darkMode);


    </script>
    
</body>
</html>