<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="timeTimerMod.css">
</head>
<body>
    <div class="graduationSection">
        <div class="circle1"></div>
        <div class="circle2"></div>
        <div class="circle3"></div>
    </div>
    <canvas class="canvas"></canvas>
    <div class="timerSection">
        <input class="setMinutes" type="number" min="1" max="60"><span class="timeLeft">남은시간표시</span>
        <div class="beforeStartBtnSection">
            <button class="timerStartBtn">타이머 시작</button>
            <button class="darkModeBtn">다크모드</button>
        </div>
        <div class="afterStartBtnSection">
            <button class="pauseTimer">타이머 일시정지</button>
            <button class="resetTimer">타이머 초기화(정지)</button>
        </div>
    </div>

    <script>
      const $canvas = document.querySelector(".canvas");
      const $setMinutes = document.querySelector(".setMinutes");
      const $timerStartBtn = document.querySelector(".timerStartBtn")
      const $darkModeBtn = document.querySelector(".darkModeBtn");
      const $showNumBtn = document.querySelector(".showNumBtn");
      const $timeLeft = document.querySelector(".timeLeft");
      const $pauseTimer = document.querySelector(".pauseTimer");
      const $resetTimer = document.querySelector(".resetTimer");
      const ctx = $canvas.getContext("2d");

      $timeLeft.style.display = 'none';

      // resize Canvas to window size
      function resizeCanvas() {
        $canvas.width = window.innerWidth;
        $canvas.height = window.innerHeight;
      }
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      // Draw red zone for left time area 
      let elapsedSec = 0, intervalDrawing;
      function drawSetTime() {
        $setMinutes.style.display = 'none';
        ctx.clearRect(0, 0, $canvas.width, $canvas.height);
        // Draw clock circle
        const centerX = $canvas.width / 2;
        const centerY = $canvas.height / 2;
        const radius = 1100;
        
        // Calculate ratio based on input minute
        const setMinutes = $setMinutes.value;
        const startAngle = (Math.PI * 3) / 2;
        const endAngle = (Math.PI * 2 / 60) * setMinutes + startAngle
        
        // Filling a portion of a clock
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, endAngle-elapsedSec, false);
        ctx.lineTo(centerX, centerY);
        ctx.fillStyle = 'rgba(255, 0, 0, 0.7)';
        ctx.fill();

        const nowEndAngle = endAngle-elapsedSec
        const diff = nowEndAngle- startAngle;
        const nowAngle = diff * (180/Math.PI);
        const nowTotalSec = nowAngle.toFixed(2)/0.1 + 1;
        const nowMin = Math.floor(nowTotalSec/60);
        const nowSec = Math.floor(nowTotalSec%60);

        //Angle value to decrease per minute
        elapsedSec += 6 * (Math.PI/180) * (1/3600);

        $timeLeft.style.display = 'block';
        $timeLeft.textContent = `${nowMin}분 ${nowSec}초`

        //For smooth movement
        intervalDrawing =  setTimeout(drawSetTime, 1000/60)
      }

      // Pause Timer
      function pauseTimer() {
        clearTimeout(intervalDrawing);
      }

      // Reset Timer
      function resetTimer() {
        location.reload();
      }

      // Dark Mode
      function darkMode() {
        $canvas.classList.toggle('darkMode');
        $darkModeBtn.textContent = ($darkModeBtn.textContent == '다크모드')? $darkModeBtn.textContent = '라이트모드' : $darkModeBtn.textContent = '다크모드'
    }

      // Make clock numerals
      function showClockNumerals() {
        const circle_1 = document.querySelector('.circle1');
        // 눈금 그리기
        for (let i = 0; i < 30; i++) {
        const line = document.createElement('div');
        line.classList.add('line');
        line.style.transform = `rotate(${6 * i}deg)`;
        if (i % 5) {
            line.classList.add('thin');
        } else {
            line.classList.add('thick');
        }
        circle_1.appendChild(line);
        }
      }

      showClockNumerals();

      $timerStartBtn.addEventListener('click', drawSetTime);
      $darkModeBtn.addEventListener('click', darkMode);
      $pauseTimer.addEventListener('click', pauseTimer);
      $resetTimer.addEventListener('click', resetTimer);
    </script>
</body>
</html>