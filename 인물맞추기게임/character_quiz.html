<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="character_quiz.css">
</head>
<body>
    <div class="screen">
        <div class="subjectSection">
            <form>
                <div>출제 주제를 선택해주세요</div>
                <button class="subjectBtn" value="sportPlayers">sportPlayers</button>
            </form>
        </div>
        <div class="numberSection">
            <form>
                <div>플레이어 수를 입력하세요.(한바퀴를 돕니다.)</div>
                <input class="numberInput"/>
                <button class="numberBtn">enter</button>
            </form>
            
        </div>
        <div class="gameScreenSection">
            <div>gameScreen</div>
            <img class="currentImage" src="" alt="image">
            <input class="answer" type="text"/>
        </div>
    </div>

    <script>
        const $subjectSection = document.querySelector(".subjectSection");
        const $subjectBtns = document.querySelectorAll(".subjectBtn");
        const $numberSection = document.querySelector(".numberSection");
        const $numberBtn = document.querySelector(".numberBtn")
        const $gameScreenSection = document.querySelector(".gameScreenSection");
        const $currentImage = document.querySelector(".currentImage")
        const $numberInput = document.querySelector(".numberInput");
        const $answer = document.querySelector(".answer");
        //button for test
        const $next = document.querySelector(".next");

        const images = ['./images/sportPlayers/김연경.jpg','./images/sportPlayers/김하성.jpg','./images/sportPlayers/박세리.jpg']

        $numberSection.style.display = 'none'
        $gameScreenSection.style.display = 'none'

        let subjectName = '';
        let imageFiles = '';
        // First screen : choose subject
        $subjectBtns.forEach(subjectBtn => {
            subjectBtn.addEventListener('click', function(e) {
                e.preventDefault();
                $subjectSection.style.display = 'none'
                $numberSection.style.display = 'block'
                subjectName = this.value;
                // call local file based on chosen subject name with fetch API
                const folderPath = `./images/${subjectName}`;
                fetch(folderPath)
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, "text/html");
                    const imageElements = doc.querySelectorAll('a[href$=".jpg"], a[href$=".jpeg"], a[href$=".png"], a[href$=".gif"]');
                    const imageFilesResult = Array.from(imageElements).map(element => element.textContent.trim().split(/(\d+)/)[0]);
                    imageFiles = [...imageFilesResult]
                })
                .catch(error => console.log(error));
            })
        })

        // Second screen : enter number of players(it goes ..)
        let questionNumber = '';
        function enterNumber(e) {
            e.preventDefault();
            questionNumber = $numberInput.value * 2 -1;
            $numberSection.style.display = 'none'
            $gameScreenSection.style.display = 'block'
            gameStart();
        }

        // Third screen : timer for preparing game.
        let photoIndex = 0;
        let randomArray = '';
        function gameStart() {
            // create random array based on number of photo
            const array = Array(questionNumber).fill().map((v,i) => i);
            randomArray = array.sort(()=> Math.random() -0.5);
            console.log(questionNumber);
            console.log(randomArray);
            $currentImage.src = `./images/${subjectName}/${imageFiles[randomArray[0]]}`;
            enter()
        }

        // Third screen : enter answer and start game again with next photo.
        function enter(e) {
            let correctAnswer = imageFiles[0].split('.')[0];
            // Use logical operator(&&) to prevent error cause of undefined.
            if(e && e.key === "Enter") {
                if(imageFiles[randomArray[photoIndex]] === `${$answer.value}.jpg`) {
                    console.log('correct!')
                    photoIndex++;
                    $currentImage.src = `./images/${subjectName}/${imageFiles[randomArray[photoIndex]]}`
                    $answer.value = "";
                    console.log(photoIndex);
                } else {
                    console.log('wrong!')
                    $answer.value = "";
                }
            } else return;
        }
        
        // $sportBtn.addEventListener('click', selectSubject);
        $numberBtn.addEventListener('click', enterNumber);
        $answer.addEventListener('keydown', enter)

    </script>
</body>
</html>